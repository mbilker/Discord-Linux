'use strict';

var _browser = require('debug/browser');

var _browser2 = _interopRequireDefault(_browser);

var _client = require('superagent/lib/client');

var _client2 = _interopRequireDefault(_client);

function _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }

var debug = (0, _browser2.default)('SuperagentMonkeyPatch');

debug('monkeypatch superagent');

// Monkey-patch `superagent`
// * Automatically include token in Authorization header.
var originalEnd = _client2.default.Request.prototype.end;
_client2.default.Request.prototype.end = function () {
  debug('request.end: ' + window.fingerprint + ' ' + window.token);
  //debug(`request.end: ${Array.prototype.slice.call(arguments)}`);

  var fingerprint = window.fingerprint;
  if (fingerprint) {
    this.set('X-Fingerprint', fingerprint);
  }
  this.set('Accept-Language', navigator.language);
  this.set('Authorization', window.token);
  var res = originalEnd.apply(this, arguments);
  debug('request res: ' + require('util').format(res));
  return res;
};
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uL3ZvaWNlX2VuZ2luZS1zcmMvc3VwZXJhZ2VudFBhdGNoLmpzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiI7Ozs7Ozs7Ozs7OztBQUdBLElBQU0sUUFBUSx1QkFBVSx1QkFBVixDQUFSOztBQUVOLE1BQU0sd0JBQU47Ozs7QUFJQSxJQUFNLGNBQWMsaUJBQVEsT0FBUixDQUFnQixTQUFoQixDQUEwQixHQUExQjtBQUNwQixpQkFBUSxPQUFSLENBQWdCLFNBQWhCLENBQTBCLEdBQTFCLEdBQWdDLFlBQVc7QUFDekMsMEJBQXNCLE9BQU8sV0FBUCxTQUFzQixPQUFPLEtBQVAsQ0FBNUM7OztBQUR5QyxNQUluQyxjQUFjLE9BQU8sV0FBUCxDQUpxQjtBQUt6QyxNQUFJLFdBQUosRUFBaUI7QUFDZixTQUFLLEdBQUwsQ0FBUyxlQUFULEVBQTBCLFdBQTFCLEVBRGU7R0FBakI7QUFHQSxPQUFLLEdBQUwsQ0FBUyxpQkFBVCxFQUE0QixVQUFVLFFBQVYsQ0FBNUIsQ0FSeUM7QUFTekMsT0FBSyxHQUFMLENBQVMsZUFBVCxFQUEwQixPQUFPLEtBQVAsQ0FBMUIsQ0FUeUM7QUFVekMsTUFBTSxNQUFNLFlBQVksS0FBWixDQUFrQixJQUFsQixFQUF3QixTQUF4QixDQUFOLENBVm1DO0FBV3pDLDBCQUFzQixRQUFRLE1BQVIsRUFBZ0IsTUFBaEIsQ0FBdUIsR0FBdkIsQ0FBdEIsRUFYeUM7QUFZekMsU0FBTyxHQUFQLENBWnlDO0NBQVgiLCJmaWxlIjoic3VwZXJhZ2VudFBhdGNoLmpzIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IGRlYnVnSW5pdCBmcm9tICdkZWJ1Zy9icm93c2VyJztcbmltcG9ydCByZXF1ZXN0IGZyb20gJ3N1cGVyYWdlbnQvbGliL2NsaWVudCc7XG5cbmNvbnN0IGRlYnVnID0gZGVidWdJbml0KCdTdXBlcmFnZW50TW9ua2V5UGF0Y2gnKTtcblxuZGVidWcoJ21vbmtleXBhdGNoIHN1cGVyYWdlbnQnKTtcblxuLy8gTW9ua2V5LXBhdGNoIGBzdXBlcmFnZW50YFxuLy8gKiBBdXRvbWF0aWNhbGx5IGluY2x1ZGUgdG9rZW4gaW4gQXV0aG9yaXphdGlvbiBoZWFkZXIuXG5jb25zdCBvcmlnaW5hbEVuZCA9IHJlcXVlc3QuUmVxdWVzdC5wcm90b3R5cGUuZW5kO1xucmVxdWVzdC5SZXF1ZXN0LnByb3RvdHlwZS5lbmQgPSBmdW5jdGlvbigpIHtcbiAgZGVidWcoYHJlcXVlc3QuZW5kOiAke3dpbmRvdy5maW5nZXJwcmludH0gJHt3aW5kb3cudG9rZW59YCk7XG4gIC8vZGVidWcoYHJlcXVlc3QuZW5kOiAke0FycmF5LnByb3RvdHlwZS5zbGljZS5jYWxsKGFyZ3VtZW50cyl9YCk7XG5cbiAgY29uc3QgZmluZ2VycHJpbnQgPSB3aW5kb3cuZmluZ2VycHJpbnQ7XG4gIGlmIChmaW5nZXJwcmludCkge1xuICAgIHRoaXMuc2V0KCdYLUZpbmdlcnByaW50JywgZmluZ2VycHJpbnQpO1xuICB9XG4gIHRoaXMuc2V0KCdBY2NlcHQtTGFuZ3VhZ2UnLCBuYXZpZ2F0b3IubGFuZ3VhZ2UpO1xuICB0aGlzLnNldCgnQXV0aG9yaXphdGlvbicsIHdpbmRvdy50b2tlbik7XG4gIGNvbnN0IHJlcyA9IG9yaWdpbmFsRW5kLmFwcGx5KHRoaXMsIGFyZ3VtZW50cyk7XG4gIGRlYnVnKGByZXF1ZXN0IHJlczogJHtyZXF1aXJlKCd1dGlsJykuZm9ybWF0KHJlcyl9YCk7XG4gIHJldHVybiByZXM7XG59O1xuIl19