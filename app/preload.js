'use strict';

var _platform = require('platform');

var _platform2 = _interopRequireDefault(_platform);

function _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }

console.log('I run before anything else');

var VoiceEngine = require('remote').require('./VoiceEngine');
var runWebpackCb = false;

function noop() {}

var VoiceEngineShim = {
  supported: true,

  autoEnable: false,

  supportsAutomaticVAD: function supportsAutomaticVAD() {
    return false;
  },
  supportsMultiplePTT: function supportsMultiplePTT() {
    return true;
  },
  supportsPTTReleaseDelay: function supportsPTTReleaseDelay() {
    return true;
  },
  canSetOutputDevice: function canSetOutputDevice() {
    return false;
  },
  supportsEncodingBitRate: function supportsEncodingBitRate() {
    return true;
  },
  canSetAttenuation: function canSetAttenuation() {
    return false;
  },
  canSetVoiceProcessing: function canSetVoiceProcessing() {
    return _platform2.default.layout === 'Blink';
  },
  collectDiagnostics: function collectDiagnostics(callback) {
    callback(null);
  },


  diagnosticsEnabled: false,

  runDiagnostics: function runDiagnostics(callback) {
    callback(null);
  },
  getDiagnosticInfo: function getDiagnosticInfo() {
    return null;
  },


  supportsNativePing: false,

  setInputVolume: noop,
  setVolumeChangeCallback: noop,
  setOutputDevice: noop,
  setAttenuation: noop,
  setPingCallback: noop,

  enable: VoiceEngine.enable,
  setForceSend: VoiceEngine.setPTTActive,
  setInputMode: VoiceEngine.setInputMode,
  setOutputVolume: VoiceEngine.setOutputVolume,
  setSelfMute: VoiceEngine.setSelfMute,
  setSelfDeaf: VoiceEngine.setSelfDeaf,
  setLocalMute: VoiceEngine.setLocalMute,
  setLocalVolume: VoiceEngine.setLocalVolume,
  createUser: VoiceEngine.createUser,
  destroyUser: VoiceEngine.destroyUser,
  //onSpeaking: VoiceEngine.onSpeaking,
  //onVoiceActivity: VoiceEngine.onVoiceActivity,
  //onDevicesChanged: VoiceEngine.onDevicesChanged,
  getInputDevices: VoiceEngine.getInputDevices,
  getOutputDevices: VoiceEngine.getOutputDevices,
  canSetInputDevice: VoiceEngine.canSetInputDevice,
  setInputDevice: VoiceEngine.setInputDevice,
  setEncodingBitRate: VoiceEngine.setEncodingBitRate,
  setEchoCancellation: VoiceEngine.setEchoCancellation,
  setNoiseSuppression: VoiceEngine.setNoiseSuppression,
  setAutomaticGainControl: VoiceEngine.setAutomaticGainControl,
  onConnectionState: VoiceEngine.onConnectionState,
  connect: VoiceEngine.connect,
  disconnect: VoiceEngine.disconnect,
  handleSessionDescription: VoiceEngine.handleSessionDescription,
  handleSpeaking: VoiceEngine.handleSpeaking,
  debugDump: VoiceEngine.debugDump,

  Constants: {}
};

function webpackCb(chunkIds, moreModules) {
  if (runWebpackCb) return;
  runWebpackCb = true;

  console.log('parent webpack:', moreModules);

  setImmediate(afterInitialJsonp);
}

function injectedModule(module, exports, webpackRequire) {
  console.log('injected module');

  var webpackVoiceEngines = [0];
  var modules = webpackRequire.c;

  window.__webpackRequire = webpackRequire;
  window.__voiceEngines = webpackVoiceEngines;

  for (var i = 0; i < webpackRequire.m.length; i++) {
    if (modules[i] && modules[i].exports && modules[i].exports.handleSessionDescription) {
      webpackVoiceEngines[0] = modules[i];
      break;
    }
  }

  if (webpackVoiceEngines[0]) {
    console.log('Found exports of NativeVoiceEngine, setting to shim...');
    for (var i = 0; i < webpackVoiceEngines.length; i++) {
      Object.assign(webpackVoiceEngines[i].exports, VoiceEngineShim);
    }
  }

  module.exports = { mbilker: true };
}

function afterInitialJsonp() {
  console.log(window['webpackJsonp']);

  window['webpackJsonp']([0], [injectedModule]);
}

//window['webpackJsonp'] = console.log.bind(console, 'parent webpack:');
window['webpackJsonp'] = webpackCb;
//# sourceMappingURL=data:application/json;base64,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QUFTdkQsT0FBSyxJQUFJLElBQUksQ0FBSixFQUFPLElBQUksZUFBZSxDQUFmLENBQWlCLE1BQWpCLEVBQXlCLEdBQTdDLEVBQWtEO0FBQ2hELFFBQUksUUFBUSxDQUFSLEtBQWMsUUFBUSxDQUFSLEVBQVcsT0FBWCxJQUFzQixRQUFRLENBQVIsRUFBVyxPQUFYLENBQW1CLHdCQUFuQixFQUE2QztBQUNuRiwwQkFBb0IsQ0FBcEIsSUFBeUIsUUFBUSxDQUFSLENBQXpCLENBRG1GO0FBRW5GLFlBRm1GO0tBQXJGO0dBREY7O0FBT0EsTUFBSSxvQkFBb0IsQ0FBcEIsQ0FBSixFQUE0QjtBQUMxQixZQUFRLEdBQVIsQ0FBWSx3REFBWixFQUQwQjtBQUUxQixTQUFLLElBQUksSUFBSSxDQUFKLEVBQU8sSUFBSSxvQkFBb0IsTUFBcEIsRUFBNEIsR0FBaEQsRUFBcUQ7QUFDbkQsYUFBTyxNQUFQLENBQWMsb0JBQW9CLENBQXBCLEVBQXVCLE9BQXZCLEVBQWdDLGVBQTlDLEVBRG1EO0tBQXJEO0dBRkY7O0FBT0EsU0FBTyxPQUFQLEdBQWlCLEVBQUUsU0FBUyxJQUFULEVBQW5CLENBdkJ1RDtDQUF6RDs7QUEwQkEsU0FBUyxpQkFBVCxHQUE2QjtBQUMzQixVQUFRLEdBQVIsQ0FBWSxPQUFPLGNBQVAsQ0FBWixFQUQyQjs7QUFHM0IsU0FBTyxjQUFQLEVBQXVCLENBQUMsQ0FBRCxDQUF2QixFQUE0QixDQUFDLGNBQUQsQ0FBNUIsRUFIMkI7Q0FBN0I7OztBQU9BLE9BQU8sY0FBUCxJQUF5QixTQUF6QiIsImZpbGUiOiJ3ZWIuVm9pY2VFbmdpbmUuc2hpbS5qcyIsInNvdXJjZXNDb250ZW50IjpbImNvbnNvbGUubG9nKCdJIHJ1biBiZWZvcmUgYW55dGhpbmcgZWxzZScpO1xuXG5pbXBvcnQgcGxhdGZvcm0gZnJvbSAncGxhdGZvcm0nO1xuXG52YXIgVm9pY2VFbmdpbmUgPSByZXF1aXJlKCdyZW1vdGUnKS5yZXF1aXJlKCcuL1ZvaWNlRW5naW5lJyk7XG52YXIgcnVuV2VicGFja0NiID0gZmFsc2U7XG5cbmZ1bmN0aW9uIG5vb3AoKSB7fVxuXG52YXIgVm9pY2VFbmdpbmVTaGltID0ge1xuICBzdXBwb3J0ZWQ6IHRydWUsXG5cbiAgYXV0b0VuYWJsZTogZmFsc2UsXG5cbiAgc3VwcG9ydHNBdXRvbWF0aWNWQUQoKSB7XG4gICAgcmV0dXJuIGZhbHNlO1xuICB9LFxuXG4gIHN1cHBvcnRzTXVsdGlwbGVQVFQoKSB7XG4gICAgcmV0dXJuIHRydWU7XG4gIH0sXG5cbiAgc3VwcG9ydHNQVFRSZWxlYXNlRGVsYXkoKSB7XG4gICAgcmV0dXJuIHRydWU7XG4gIH0sXG5cbiAgY2FuU2V0T3V0cHV0RGV2aWNlKCkge1xuICAgIHJldHVybiBmYWxzZTtcbiAgfSxcblxuICBzdXBwb3J0c0VuY29kaW5nQml0UmF0ZSgpIHtcbiAgICByZXR1cm4gdHJ1ZTtcbiAgfSxcblxuICBjYW5TZXRBdHRlbnVhdGlvbigpIHtcbiAgICByZXR1cm4gZmFsc2U7XG4gIH0sXG5cbiAgY2FuU2V0Vm9pY2VQcm9jZXNzaW5nKCkge1xuICAgIHJldHVybiBwbGF0Zm9ybS5sYXlvdXQgPT09ICdCbGluayc7XG4gIH0sXG5cbiAgY29sbGVjdERpYWdub3N0aWNzKGNhbGxiYWNrKSB7XG4gICAgY2FsbGJhY2sobnVsbCk7XG4gIH0sXG5cbiAgZGlhZ25vc3RpY3NFbmFibGVkOiBmYWxzZSxcblxuICBydW5EaWFnbm9zdGljcyhjYWxsYmFjaykge1xuICAgIGNhbGxiYWNrKG51bGwpO1xuICB9LFxuXG4gIGdldERpYWdub3N0aWNJbmZvKCkge1xuICAgIHJldHVybiBudWxsO1xuICB9LFxuXG4gIHN1cHBvcnRzTmF0aXZlUGluZzogZmFsc2UsXG5cbiAgc2V0SW5wdXRWb2x1bWU6IG5vb3AsXG4gIHNldFZvbHVtZUNoYW5nZUNhbGxiYWNrOiBub29wLFxuICBzZXRPdXRwdXREZXZpY2U6IG5vb3AsXG4gIHNldEF0dGVudWF0aW9uOiBub29wLFxuICBzZXRQaW5nQ2FsbGJhY2s6IG5vb3AsXG5cbiAgZW5hYmxlOiBWb2ljZUVuZ2luZS5lbmFibGUsXG4gIHNldEZvcmNlU2VuZDogVm9pY2VFbmdpbmUuc2V0UFRUQWN0aXZlLFxuICBzZXRJbnB1dE1vZGU6IFZvaWNlRW5naW5lLnNldElucHV0TW9kZSxcbiAgc2V0T3V0cHV0Vm9sdW1lOiBWb2ljZUVuZ2luZS5zZXRPdXRwdXRWb2x1bWUsXG4gIHNldFNlbGZNdXRlOiBWb2ljZUVuZ2luZS5zZXRTZWxmTXV0ZSxcbiAgc2V0U2VsZkRlYWY6IFZvaWNlRW5naW5lLnNldFNlbGZEZWFmLFxuICBzZXRMb2NhbE11dGU6IFZvaWNlRW5naW5lLnNldExvY2FsTXV0ZSxcbiAgc2V0TG9jYWxWb2x1bWU6IFZvaWNlRW5naW5lLnNldExvY2FsVm9sdW1lLFxuICBjcmVhdGVVc2VyOiBWb2ljZUVuZ2luZS5jcmVhdGVVc2VyLFxuICBkZXN0cm95VXNlcjogVm9pY2VFbmdpbmUuZGVzdHJveVVzZXIsXG4gIC8vb25TcGVha2luZzogVm9pY2VFbmdpbmUub25TcGVha2luZyxcbiAgLy9vblZvaWNlQWN0aXZpdHk6IFZvaWNlRW5naW5lLm9uVm9pY2VBY3Rpdml0eSxcbiAgLy9vbkRldmljZXNDaGFuZ2VkOiBWb2ljZUVuZ2luZS5vbkRldmljZXNDaGFuZ2VkLFxuICBnZXRJbnB1dERldmljZXM6IFZvaWNlRW5naW5lLmdldElucHV0RGV2aWNlcyxcbiAgZ2V0T3V0cHV0RGV2aWNlczogVm9pY2VFbmdpbmUuZ2V0T3V0cHV0RGV2aWNlcyxcbiAgY2FuU2V0SW5wdXREZXZpY2U6IFZvaWNlRW5naW5lLmNhblNldElucHV0RGV2aWNlLFxuICBzZXRJbnB1dERldmljZTogVm9pY2VFbmdpbmUuc2V0SW5wdXREZXZpY2UsXG4gIHNldEVuY29kaW5nQml0UmF0ZTogVm9pY2VFbmdpbmUuc2V0RW5jb2RpbmdCaXRSYXRlLFxuICBzZXRFY2hvQ2FuY2VsbGF0aW9uOiBWb2ljZUVuZ2luZS5zZXRFY2hvQ2FuY2VsbGF0aW9uLFxuICBzZXROb2lzZVN1cHByZXNzaW9uOiBWb2ljZUVuZ2luZS5zZXROb2lzZVN1cHByZXNzaW9uLFxuICBzZXRBdXRvbWF0aWNHYWluQ29udHJvbDogVm9pY2VFbmdpbmUuc2V0QXV0b21hdGljR2FpbkNvbnRyb2wsXG4gIG9uQ29ubmVjdGlvblN0YXRlOiBWb2ljZUVuZ2luZS5vbkNvbm5lY3Rpb25TdGF0ZSxcbiAgY29ubmVjdDogVm9pY2VFbmdpbmUuY29ubmVjdCxcbiAgZGlzY29ubmVjdDogVm9pY2VFbmdpbmUuZGlzY29ubmVjdCxcbiAgaGFuZGxlU2Vzc2lvbkRlc2NyaXB0aW9uOiBWb2ljZUVuZ2luZS5oYW5kbGVTZXNzaW9uRGVzY3JpcHRpb24sXG4gIGhhbmRsZVNwZWFraW5nOiBWb2ljZUVuZ2luZS5oYW5kbGVTcGVha2luZyxcbiAgZGVidWdEdW1wOiBWb2ljZUVuZ2luZS5kZWJ1Z0R1bXAsXG5cbiAgQ29uc3RhbnRzOiB7fVxufTtcblxuZnVuY3Rpb24gd2VicGFja0NiKGNodW5rSWRzLCBtb3JlTW9kdWxlcykge1xuICBpZiAocnVuV2VicGFja0NiKSByZXR1cm47XG4gIHJ1bldlYnBhY2tDYiA9IHRydWU7XG5cbiAgY29uc29sZS5sb2coJ3BhcmVudCB3ZWJwYWNrOicsIG1vcmVNb2R1bGVzKTtcblxuICBzZXRJbW1lZGlhdGUoYWZ0ZXJJbml0aWFsSnNvbnApO1xufVxuXG5mdW5jdGlvbiBpbmplY3RlZE1vZHVsZShtb2R1bGUsIGV4cG9ydHMsIHdlYnBhY2tSZXF1aXJlKSB7XG4gIGNvbnNvbGUubG9nKCdpbmplY3RlZCBtb2R1bGUnKTtcblxuICB2YXIgd2VicGFja1ZvaWNlRW5naW5lcyA9IFswXTtcbiAgdmFyIG1vZHVsZXMgPSB3ZWJwYWNrUmVxdWlyZS5jO1xuXG4gIHdpbmRvdy5fX3dlYnBhY2tSZXF1aXJlID0gd2VicGFja1JlcXVpcmU7XG4gIHdpbmRvdy5fX3ZvaWNlRW5naW5lcyA9IHdlYnBhY2tWb2ljZUVuZ2luZXM7XG5cbiAgZm9yICh2YXIgaSA9IDA7IGkgPCB3ZWJwYWNrUmVxdWlyZS5tLmxlbmd0aDsgaSsrKSB7XG4gICAgaWYgKG1vZHVsZXNbaV0gJiYgbW9kdWxlc1tpXS5leHBvcnRzICYmIG1vZHVsZXNbaV0uZXhwb3J0cy5oYW5kbGVTZXNzaW9uRGVzY3JpcHRpb24pIHtcbiAgICAgIHdlYnBhY2tWb2ljZUVuZ2luZXNbMF0gPSBtb2R1bGVzW2ldO1xuICAgICAgYnJlYWs7XG4gICAgfVxuICB9XG5cbiAgaWYgKHdlYnBhY2tWb2ljZUVuZ2luZXNbMF0pIHtcbiAgICBjb25zb2xlLmxvZygnRm91bmQgZXhwb3J0cyBvZiBOYXRpdmVWb2ljZUVuZ2luZSwgc2V0dGluZyB0byBzaGltLi4uJyk7XG4gICAgZm9yICh2YXIgaSA9IDA7IGkgPCB3ZWJwYWNrVm9pY2VFbmdpbmVzLmxlbmd0aDsgaSsrKSB7XG4gICAgICBPYmplY3QuYXNzaWduKHdlYnBhY2tWb2ljZUVuZ2luZXNbaV0uZXhwb3J0cywgVm9pY2VFbmdpbmVTaGltKTtcbiAgICB9XG4gIH1cblxuICBtb2R1bGUuZXhwb3J0cyA9IHsgbWJpbGtlcjogdHJ1ZSB9O1xufVxuXG5mdW5jdGlvbiBhZnRlckluaXRpYWxKc29ucCgpIHtcbiAgY29uc29sZS5sb2cod2luZG93Wyd3ZWJwYWNrSnNvbnAnXSk7XG5cbiAgd2luZG93Wyd3ZWJwYWNrSnNvbnAnXShbMF0sIFtpbmplY3RlZE1vZHVsZV0pO1xufVxuXG4vL3dpbmRvd1snd2VicGFja0pzb25wJ10gPSBjb25zb2xlLmxvZy5iaW5kKGNvbnNvbGUsICdwYXJlbnQgd2VicGFjazonKTtcbndpbmRvd1snd2VicGFja0pzb25wJ10gPSB3ZWJwYWNrQ2I7XG4iXX0=

//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IiIsImZpbGUiOiJwcmVsb2FkLmpzIn0=