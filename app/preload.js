'use strict';

var _platform = require('platform');

var _platform2 = _interopRequireDefault(_platform);

function _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }

console.log('I run before anything else');

var VoiceEngine = require('remote').require('./VoiceEngine');
var runWebpackCb = false;

function noop() {}

var VoiceEngineShim = {
  supported: true,

  autoEnable: false,

  supportsAutomaticVAD: function supportsAutomaticVAD() {
    return false;
  },
  supportsMultiplePTT: function supportsMultiplePTT() {
    return true;
  },
  supportsPTTReleaseDelay: function supportsPTTReleaseDelay() {
    return true;
  },
  canSetOutputDevice: function canSetOutputDevice() {
    return false;
  },
  supportsEncodingBitRate: function supportsEncodingBitRate() {
    return true;
  },
  canSetAttenuation: function canSetAttenuation() {
    return false;
  },
  canSetVoiceProcessing: function canSetVoiceProcessing() {
    return _platform2.default.layout === 'Blink';
  },
  setNoInputCallback: function setNoInputCallback() {},
  setNoInputThreshold: function setNoInputThreshold() {},
  collectDiagnostics: function collectDiagnostics(callback) {
    callback(null);
  },


  diagnosticsEnabled: false,

  runDiagnostics: function runDiagnostics(callback) {
    callback(null);
  },
  getDiagnosticInfo: function getDiagnosticInfo() {
    return null;
  },


  supportsNativePing: false,

  setInputVolume: noop,
  setVolumeChangeCallback: noop,
  setOutputDevice: noop,
  setAttenuation: noop,
  setPingCallback: noop,

  enable: VoiceEngine.enable,
  setForceSend: VoiceEngine.setPTTActive,
  setInputMode: VoiceEngine.setInputMode,
  setOutputVolume: VoiceEngine.setOutputVolume,
  setSelfMute: VoiceEngine.setSelfMute,
  setSelfDeaf: VoiceEngine.setSelfDeaf,
  setLocalMute: VoiceEngine.setLocalMute,
  setLocalVolume: VoiceEngine.setLocalVolume,
  createUser: VoiceEngine.createUser,
  destroyUser: VoiceEngine.destroyUser,
  //onSpeaking: VoiceEngine.onSpeaking,
  //onVoiceActivity: VoiceEngine.onVoiceActivity,
  //onDevicesChanged: VoiceEngine.onDevicesChanged,
  getInputDevices: VoiceEngine.getInputDevices,
  getOutputDevices: VoiceEngine.getOutputDevices,
  canSetInputDevice: VoiceEngine.canSetInputDevice,
  setInputDevice: VoiceEngine.setInputDevice,
  setEncodingBitRate: VoiceEngine.setEncodingBitRate,
  setEchoCancellation: VoiceEngine.setEchoCancellation,
  setNoiseSuppression: VoiceEngine.setNoiseSuppression,
  setAutomaticGainControl: VoiceEngine.setAutomaticGainControl,
  onConnectionState: VoiceEngine.onConnectionState,
  connect: VoiceEngine.connect,
  disconnect: VoiceEngine.disconnect,
  handleSessionDescription: VoiceEngine.handleSessionDescription,
  handleSpeaking: VoiceEngine.handleSpeaking,
  debugDump: VoiceEngine.debugDump,

  Constants: {}
};

function webpackCb(chunkIds, moreModules) {
  if (runWebpackCb) return;
  runWebpackCb = true;

  console.log('parent webpack:', moreModules);

  setImmediate(afterInitialJsonp);
}

function injectedModule(module, exports, webpackRequire) {
  console.log('injected module');
  window.__webpackRequre = webpackRequire;
  console.log(webpackRequire.c);

  var webpackVoiceEngines = [0];
  var modules = webpackRequire.c;

  for (var i = 0; i < webpackRequire.m.length; i++) {
    if (modules[i] && modules[i].exports && modules[i].exports.handleSessionDescription) {
      webpackVoiceEngines[0] = modules[i];
      break;
    }
  }

  if (webpackVoiceEngines[0]) {
    console.log('Found exports of NativeVoiceEngine, setting to shim...');
    for (var i = 0; i < webpackVoiceEngines.length; i++) {
      Object.assign(webpackVoiceEngines[i].exports, VoiceEngineShim);
    }
  }

  module.exports = { mbilker: true };
}

function afterInitialJsonp() {
  console.log(window['webpackJsonp']);

  window['webpackJsonp']([0], [injectedModule]);
}

//window['webpackJsonp'] = console.log.bind(console, 'parent webpack:');
window['webpackJsonp'] = webpackCb;
//# sourceMappingURL=data:application/json;base64,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Q0FBdEIsQ0FMbUQ7QUFNdkQsTUFBSSxVQUFVLGVBQWUsQ0FBZixDQU55Qzs7QUFRdkQsT0FBSyxJQUFJLElBQUksQ0FBSixFQUFPLElBQUksZUFBZSxDQUFmLENBQWlCLE1BQWpCLEVBQXlCLEdBQTdDLEVBQWtEO0FBQ2hELFFBQUksUUFBUSxDQUFSLEtBQWMsUUFBUSxDQUFSLEVBQVcsT0FBWCxJQUFzQixRQUFRLENBQVIsRUFBVyxPQUFYLENBQW1CLHdCQUFuQixFQUE2QztBQUNuRiwwQkFBb0IsQ0FBcEIsSUFBeUIsUUFBUSxDQUFSLENBQXpCLENBRG1GO0FBRW5GLFlBRm1GO0tBQXJGO0dBREY7O0FBT0EsTUFBSSxvQkFBb0IsQ0FBcEIsQ0FBSixFQUE0QjtBQUMxQixZQUFRLEdBQVIsQ0FBWSx3REFBWixFQUQwQjtBQUUxQixTQUFLLElBQUksSUFBSSxDQUFKLEVBQU8sSUFBSSxvQkFBb0IsTUFBcEIsRUFBNEIsR0FBaEQsRUFBcUQ7QUFDbkQsYUFBTyxNQUFQLENBQWMsb0JBQW9CLENBQXBCLEVBQXVCLE9BQXZCLEVBQWdDLGVBQTlDLEVBRG1EO0tBQXJEO0dBRkY7O0FBT0EsU0FBTyxPQUFQLEdBQWlCLEVBQUUsU0FBUyxJQUFULEVBQW5CLENBdEJ1RDtDQUF6RDs7QUF5QkEsU0FBUyxpQkFBVCxHQUE2QjtBQUMzQixVQUFRLEdBQVIsQ0FBWSxPQUFPLGNBQVAsQ0FBWixFQUQyQjs7QUFHM0IsU0FBTyxjQUFQLEVBQXVCLENBQUMsQ0FBRCxDQUF2QixFQUE0QixDQUFDLGNBQUQsQ0FBNUIsRUFIMkI7Q0FBN0I7OztBQU9BLE9BQU8sY0FBUCxJQUF5QixTQUF6QiIsImZpbGUiOiJ3ZWIuVm9pY2VFbmdpbmUuc2hpbS5qcyIsInNvdXJjZXNDb250ZW50IjpbImNvbnNvbGUubG9nKCdJIHJ1biBiZWZvcmUgYW55dGhpbmcgZWxzZScpO1xuXG5pbXBvcnQgcGxhdGZvcm0gZnJvbSAncGxhdGZvcm0nO1xuXG52YXIgVm9pY2VFbmdpbmUgPSByZXF1aXJlKCdyZW1vdGUnKS5yZXF1aXJlKCcuL1ZvaWNlRW5naW5lJyk7XG52YXIgcnVuV2VicGFja0NiID0gZmFsc2U7XG5cbmZ1bmN0aW9uIG5vb3AoKSB7fVxuXG52YXIgVm9pY2VFbmdpbmVTaGltID0ge1xuICBzdXBwb3J0ZWQ6IHRydWUsXG5cbiAgYXV0b0VuYWJsZTogZmFsc2UsXG5cbiAgc3VwcG9ydHNBdXRvbWF0aWNWQUQoKSB7XG4gICAgcmV0dXJuIGZhbHNlO1xuICB9LFxuXG4gIHN1cHBvcnRzTXVsdGlwbGVQVFQoKSB7XG4gICAgcmV0dXJuIHRydWU7XG4gIH0sXG5cbiAgc3VwcG9ydHNQVFRSZWxlYXNlRGVsYXkoKSB7XG4gICAgcmV0dXJuIHRydWU7XG4gIH0sXG5cbiAgY2FuU2V0T3V0cHV0RGV2aWNlKCkge1xuICAgIHJldHVybiBmYWxzZTtcbiAgfSxcblxuICBzdXBwb3J0c0VuY29kaW5nQml0UmF0ZSgpIHtcbiAgICByZXR1cm4gdHJ1ZTtcbiAgfSxcblxuICBjYW5TZXRBdHRlbnVhdGlvbigpIHtcbiAgICByZXR1cm4gZmFsc2U7XG4gIH0sXG5cbiAgY2FuU2V0Vm9pY2VQcm9jZXNzaW5nKCkge1xuICAgIHJldHVybiBwbGF0Zm9ybS5sYXlvdXQgPT09ICdCbGluayc7XG4gIH0sXG5cbiAgc2V0Tm9JbnB1dENhbGxiYWNrKCkge30sXG5cbiAgc2V0Tm9JbnB1dFRocmVzaG9sZCgpIHt9LFxuXG4gIGNvbGxlY3REaWFnbm9zdGljcyhjYWxsYmFjaykge1xuICAgIGNhbGxiYWNrKG51bGwpO1xuICB9LFxuXG4gIGRpYWdub3N0aWNzRW5hYmxlZDogZmFsc2UsXG5cbiAgcnVuRGlhZ25vc3RpY3MoY2FsbGJhY2spIHtcbiAgICBjYWxsYmFjayhudWxsKTtcbiAgfSxcblxuICBnZXREaWFnbm9zdGljSW5mbygpIHtcbiAgICByZXR1cm4gbnVsbDtcbiAgfSxcblxuICBzdXBwb3J0c05hdGl2ZVBpbmc6IGZhbHNlLFxuXG4gIHNldElucHV0Vm9sdW1lOiBub29wLFxuICBzZXRWb2x1bWVDaGFuZ2VDYWxsYmFjazogbm9vcCxcbiAgc2V0T3V0cHV0RGV2aWNlOiBub29wLFxuICBzZXRBdHRlbnVhdGlvbjogbm9vcCxcbiAgc2V0UGluZ0NhbGxiYWNrOiBub29wLFxuXG4gIGVuYWJsZTogVm9pY2VFbmdpbmUuZW5hYmxlLFxuICBzZXRGb3JjZVNlbmQ6IFZvaWNlRW5naW5lLnNldFBUVEFjdGl2ZSxcbiAgc2V0SW5wdXRNb2RlOiBWb2ljZUVuZ2luZS5zZXRJbnB1dE1vZGUsXG4gIHNldE91dHB1dFZvbHVtZTogVm9pY2VFbmdpbmUuc2V0T3V0cHV0Vm9sdW1lLFxuICBzZXRTZWxmTXV0ZTogVm9pY2VFbmdpbmUuc2V0U2VsZk11dGUsXG4gIHNldFNlbGZEZWFmOiBWb2ljZUVuZ2luZS5zZXRTZWxmRGVhZixcbiAgc2V0TG9jYWxNdXRlOiBWb2ljZUVuZ2luZS5zZXRMb2NhbE11dGUsXG4gIHNldExvY2FsVm9sdW1lOiBWb2ljZUVuZ2luZS5zZXRMb2NhbFZvbHVtZSxcbiAgY3JlYXRlVXNlcjogVm9pY2VFbmdpbmUuY3JlYXRlVXNlcixcbiAgZGVzdHJveVVzZXI6IFZvaWNlRW5naW5lLmRlc3Ryb3lVc2VyLFxuICAvL29uU3BlYWtpbmc6IFZvaWNlRW5naW5lLm9uU3BlYWtpbmcsXG4gIC8vb25Wb2ljZUFjdGl2aXR5OiBWb2ljZUVuZ2luZS5vblZvaWNlQWN0aXZpdHksXG4gIC8vb25EZXZpY2VzQ2hhbmdlZDogVm9pY2VFbmdpbmUub25EZXZpY2VzQ2hhbmdlZCxcbiAgZ2V0SW5wdXREZXZpY2VzOiBWb2ljZUVuZ2luZS5nZXRJbnB1dERldmljZXMsXG4gIGdldE91dHB1dERldmljZXM6IFZvaWNlRW5naW5lLmdldE91dHB1dERldmljZXMsXG4gIGNhblNldElucHV0RGV2aWNlOiBWb2ljZUVuZ2luZS5jYW5TZXRJbnB1dERldmljZSxcbiAgc2V0SW5wdXREZXZpY2U6IFZvaWNlRW5naW5lLnNldElucHV0RGV2aWNlLFxuICBzZXRFbmNvZGluZ0JpdFJhdGU6IFZvaWNlRW5naW5lLnNldEVuY29kaW5nQml0UmF0ZSxcbiAgc2V0RWNob0NhbmNlbGxhdGlvbjogVm9pY2VFbmdpbmUuc2V0RWNob0NhbmNlbGxhdGlvbixcbiAgc2V0Tm9pc2VTdXBwcmVzc2lvbjogVm9pY2VFbmdpbmUuc2V0Tm9pc2VTdXBwcmVzc2lvbixcbiAgc2V0QXV0b21hdGljR2FpbkNvbnRyb2w6IFZvaWNlRW5naW5lLnNldEF1dG9tYXRpY0dhaW5Db250cm9sLFxuICBvbkNvbm5lY3Rpb25TdGF0ZTogVm9pY2VFbmdpbmUub25Db25uZWN0aW9uU3RhdGUsXG4gIGNvbm5lY3Q6IFZvaWNlRW5naW5lLmNvbm5lY3QsXG4gIGRpc2Nvbm5lY3Q6IFZvaWNlRW5naW5lLmRpc2Nvbm5lY3QsXG4gIGhhbmRsZVNlc3Npb25EZXNjcmlwdGlvbjogVm9pY2VFbmdpbmUuaGFuZGxlU2Vzc2lvbkRlc2NyaXB0aW9uLFxuICBoYW5kbGVTcGVha2luZzogVm9pY2VFbmdpbmUuaGFuZGxlU3BlYWtpbmcsXG4gIGRlYnVnRHVtcDogVm9pY2VFbmdpbmUuZGVidWdEdW1wLFxuXG4gIENvbnN0YW50czoge31cbn07XG5cbmZ1bmN0aW9uIHdlYnBhY2tDYihjaHVua0lkcywgbW9yZU1vZHVsZXMpIHtcbiAgaWYgKHJ1bldlYnBhY2tDYikgcmV0dXJuO1xuICBydW5XZWJwYWNrQ2IgPSB0cnVlO1xuXG4gIGNvbnNvbGUubG9nKCdwYXJlbnQgd2VicGFjazonLCBtb3JlTW9kdWxlcyk7XG5cbiAgc2V0SW1tZWRpYXRlKGFmdGVySW5pdGlhbEpzb25wKTtcbn1cblxuZnVuY3Rpb24gaW5qZWN0ZWRNb2R1bGUobW9kdWxlLCBleHBvcnRzLCB3ZWJwYWNrUmVxdWlyZSkge1xuICBjb25zb2xlLmxvZygnaW5qZWN0ZWQgbW9kdWxlJyk7XG4gIHdpbmRvdy5fX3dlYnBhY2tSZXF1cmUgPSB3ZWJwYWNrUmVxdWlyZTtcbiAgY29uc29sZS5sb2cod2VicGFja1JlcXVpcmUuYyk7XG5cbiAgdmFyIHdlYnBhY2tWb2ljZUVuZ2luZXMgPSBbMF07XG4gIHZhciBtb2R1bGVzID0gd2VicGFja1JlcXVpcmUuYztcblxuICBmb3IgKHZhciBpID0gMDsgaSA8IHdlYnBhY2tSZXF1aXJlLm0ubGVuZ3RoOyBpKyspIHtcbiAgICBpZiAobW9kdWxlc1tpXSAmJiBtb2R1bGVzW2ldLmV4cG9ydHMgJiYgbW9kdWxlc1tpXS5leHBvcnRzLmhhbmRsZVNlc3Npb25EZXNjcmlwdGlvbikge1xuICAgICAgd2VicGFja1ZvaWNlRW5naW5lc1swXSA9IG1vZHVsZXNbaV07XG4gICAgICBicmVhaztcbiAgICB9XG4gIH1cblxuICBpZiAod2VicGFja1ZvaWNlRW5naW5lc1swXSkge1xuICAgIGNvbnNvbGUubG9nKCdGb3VuZCBleHBvcnRzIG9mIE5hdGl2ZVZvaWNlRW5naW5lLCBzZXR0aW5nIHRvIHNoaW0uLi4nKTtcbiAgICBmb3IgKHZhciBpID0gMDsgaSA8IHdlYnBhY2tWb2ljZUVuZ2luZXMubGVuZ3RoOyBpKyspIHtcbiAgICAgIE9iamVjdC5hc3NpZ24od2VicGFja1ZvaWNlRW5naW5lc1tpXS5leHBvcnRzLCBWb2ljZUVuZ2luZVNoaW0pO1xuICAgIH1cbiAgfVxuXG4gIG1vZHVsZS5leHBvcnRzID0geyBtYmlsa2VyOiB0cnVlIH07XG59XG5cbmZ1bmN0aW9uIGFmdGVySW5pdGlhbEpzb25wKCkge1xuICBjb25zb2xlLmxvZyh3aW5kb3dbJ3dlYnBhY2tKc29ucCddKTtcblxuICB3aW5kb3dbJ3dlYnBhY2tKc29ucCddKFswXSwgW2luamVjdGVkTW9kdWxlXSk7XG59XG5cbi8vd2luZG93Wyd3ZWJwYWNrSnNvbnAnXSA9IGNvbnNvbGUubG9nLmJpbmQoY29uc29sZSwgJ3BhcmVudCB3ZWJwYWNrOicpO1xud2luZG93Wyd3ZWJwYWNrSnNvbnAnXSA9IHdlYnBhY2tDYjtcbiJdfQ==

//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IiIsImZpbGUiOiJwcmVsb2FkLmpzIn0=