'use strict';

var _platform = require('platform');

var _platform2 = _interopRequireDefault(_platform);

function _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }

console.log('I run before anything else');

var VoiceEngine = require('remote').require('./VoiceEngine');
var runWebpackCb = false;

function noop() {}

var VoiceEngineShim = {
  supported: true,

  autoEnable: false,

  supportsAutomaticVAD: function supportsAutomaticVAD() {
    return false;
  },
  supportsMultiplePTT: function supportsMultiplePTT() {
    return true;
  },
  supportsPTTReleaseDelay: function supportsPTTReleaseDelay() {
    return true;
  },
  canSetOutputDevice: function canSetOutputDevice() {
    return false;
  },
  supportsEncodingBitRate: function supportsEncodingBitRate() {
    return true;
  },
  canSetAttenuation: function canSetAttenuation() {
    return false;
  },
  canSetVoiceProcessing: function canSetVoiceProcessing() {
    return _platform2.default.layout === 'Blink';
  },
  setNoInputCallback: function setNoInputCallback() {},
  setNoInputThreshold: function setNoInputThreshold() {},
  collectDiagnostics: function collectDiagnostics(callback) {
    callback(null);
  },


  diagnosticsEnabled: false,

  runDiagnostics: function runDiagnostics(callback) {
    callback(null);
  },
  getDiagnosticInfo: function getDiagnosticInfo() {
    return null;
  },


  supportsNativePing: false,

  setInputVolume: noop,
  setVolumeChangeCallback: noop,
  setOutputDevice: noop,
  setAttenuation: noop,
  setPingCallback: noop,

  enable: VoiceEngine.enable,
  setForceSend: VoiceEngine.setPTTActive,
  setInputMode: VoiceEngine.setInputMode,
  setOutputVolume: VoiceEngine.setOutputVolume,
  setSelfMute: VoiceEngine.setSelfMute,
  setSelfDeaf: VoiceEngine.setSelfDeaf,
  setLocalMute: VoiceEngine.setLocalMute,
  setLocalVolume: VoiceEngine.setLocalVolume,
  createUser: VoiceEngine.createUser,
  destroyUser: VoiceEngine.destroyUser,
  onSpeaking: VoiceEngine.onSpeaking,
  onVoiceActivity: VoiceEngine.onVoiceActivity,
  onDevicesChanged: VoiceEngine.onDevicesChanged,
  getInputDevices: VoiceEngine.getInputDevices,
  getOutputDevices: VoiceEngine.getOutputDevices,
  canSetInputDevice: VoiceEngine.canSetInputDevice,
  setInputDevice: VoiceEngine.setInputDevice,
  setEncodingBitRate: VoiceEngine.setEncodingBitRate,
  setEchoCancellation: VoiceEngine.setEchoCancellation,
  setNoiseSuppression: VoiceEngine.setNoiseSuppression,
  setAutomaticGainControl: VoiceEngine.setAutomaticGainControl,
  onConnectionState: VoiceEngine.onConnectionState,
  connect: VoiceEngine.connect,
  disconnect: VoiceEngine.disconnect,
  handleSessionDescription: VoiceEngine.handleSessionDescription,
  handleSpeaking: VoiceEngine.handleSpeaking,
  debugDump: VoiceEngine.debugDump,

  Constants: {}
};

function webpackCb(chunkIds, moreModules) {
  if (runWebpackCb) return;
  runWebpackCb = true;

  console.log('parent webpack:', moreModules);

  setImmediate(afterInitialJsonp);
}

function injectedModule(module, exports, webpackRequire) {
  console.log('injected module');
  window.__webpackRequre = webpackRequire;
  console.log(webpackRequire.c);

  var webpackVoiceEngines = [0];
  var modules = webpackRequire.c;

  for (var i = 0; i < webpackRequire.m.length; i++) {
    if (modules[i] && modules[i].exports && modules[i].exports.handleSessionDescription) {
      webpackVoiceEngines[0] = modules[i];
      break;
    }
  }

  if (webpackVoiceEngines[0]) {
    console.log('Found exports of NativeVoiceEngine, setting to shim...');
    for (var i = 0; i < webpackVoiceEngines.length; i++) {
      Object.assign(webpackVoiceEngines[i].exports, VoiceEngineShim);
    }
  }

  module.exports = { mbilker: true };
}

function afterInitialJsonp() {
  console.log(window['webpackJsonp']);

  window['webpackJsonp']([0], [injectedModule]);
}

//window['webpackJsonp'] = console.log.bind(console, 'parent webpack:');
window['webpackJsonp'] = webpackCb;
//# sourceMappingURL=data:application/json;base64,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QUFRLEdBQVIsQ0FBWSxlQUFlLENBQWYsQ0FBWixDQUh1RDs7QUFLdkQsTUFBSSxzQkFBc0IsQ0FBQyxDQUFELENBQXRCLENBTG1EO0FBTXZELE1BQUksVUFBVSxlQUFlLENBQWYsQ0FOeUM7O0FBUXZELE9BQUssSUFBSSxJQUFJLENBQUosRUFBTyxJQUFJLGVBQWUsQ0FBZixDQUFpQixNQUFqQixFQUF5QixHQUE3QyxFQUFrRDtBQUNoRCxRQUFJLFFBQVEsQ0FBUixLQUFjLFFBQVEsQ0FBUixFQUFXLE9BQVgsSUFBc0IsUUFBUSxDQUFSLEVBQVcsT0FBWCxDQUFtQix3QkFBbkIsRUFBNkM7QUFDbkYsMEJBQW9CLENBQXBCLElBQXlCLFFBQVEsQ0FBUixDQUF6QixDQURtRjtBQUVuRixZQUZtRjtLQUFyRjtHQURGOztBQU9BLE1BQUksb0JBQW9CLENBQXBCLENBQUosRUFBNEI7QUFDMUIsWUFBUSxHQUFSLENBQVksd0RBQVosRUFEMEI7QUFFMUIsU0FBSyxJQUFJLElBQUksQ0FBSixFQUFPLElBQUksb0JBQW9CLE1BQXBCLEVBQTRCLEdBQWhELEVBQXFEO0FBQ25ELGFBQU8sTUFBUCxDQUFjLG9CQUFvQixDQUFwQixFQUF1QixPQUF2QixFQUFnQyxlQUE5QyxFQURtRDtLQUFyRDtHQUZGOztBQU9BLFNBQU8sT0FBUCxHQUFpQixFQUFFLFNBQVMsSUFBVCxFQUFuQixDQXRCdUQ7Q0FBekQ7O0FBeUJBLFNBQVMsaUJBQVQsR0FBNkI7QUFDM0IsVUFBUSxHQUFSLENBQVksT0FBTyxjQUFQLENBQVosRUFEMkI7O0FBRzNCLFNBQU8sY0FBUCxFQUF1QixDQUFDLENBQUQsQ0FBdkIsRUFBNEIsQ0FBQyxjQUFELENBQTVCLEVBSDJCO0NBQTdCOzs7QUFPQSxPQUFPLGNBQVAsSUFBeUIsU0FBekIiLCJmaWxlIjoid2ViLlZvaWNlRW5naW5lLnNoaW0uanMiLCJzb3VyY2VzQ29udGVudCI6WyJjb25zb2xlLmxvZygnSSBydW4gYmVmb3JlIGFueXRoaW5nIGVsc2UnKTtcblxuaW1wb3J0IHBsYXRmb3JtIGZyb20gJ3BsYXRmb3JtJztcblxudmFyIFZvaWNlRW5naW5lID0gcmVxdWlyZSgncmVtb3RlJykucmVxdWlyZSgnLi9Wb2ljZUVuZ2luZScpO1xudmFyIHJ1bldlYnBhY2tDYiA9IGZhbHNlO1xuXG5mdW5jdGlvbiBub29wKCkge31cblxudmFyIFZvaWNlRW5naW5lU2hpbSA9IHtcbiAgc3VwcG9ydGVkOiB0cnVlLFxuXG4gIGF1dG9FbmFibGU6IGZhbHNlLFxuXG4gIHN1cHBvcnRzQXV0b21hdGljVkFEKCkge1xuICAgIHJldHVybiBmYWxzZTtcbiAgfSxcblxuICBzdXBwb3J0c011bHRpcGxlUFRUKCkge1xuICAgIHJldHVybiB0cnVlO1xuICB9LFxuXG4gIHN1cHBvcnRzUFRUUmVsZWFzZURlbGF5KCkge1xuICAgIHJldHVybiB0cnVlO1xuICB9LFxuXG4gIGNhblNldE91dHB1dERldmljZSgpIHtcbiAgICByZXR1cm4gZmFsc2U7XG4gIH0sXG5cbiAgc3VwcG9ydHNFbmNvZGluZ0JpdFJhdGUoKSB7XG4gICAgcmV0dXJuIHRydWU7XG4gIH0sXG5cbiAgY2FuU2V0QXR0ZW51YXRpb24oKSB7XG4gICAgcmV0dXJuIGZhbHNlO1xuICB9LFxuXG4gIGNhblNldFZvaWNlUHJvY2Vzc2luZygpIHtcbiAgICByZXR1cm4gcGxhdGZvcm0ubGF5b3V0ID09PSAnQmxpbmsnO1xuICB9LFxuXG4gIHNldE5vSW5wdXRDYWxsYmFjaygpIHt9LFxuXG4gIHNldE5vSW5wdXRUaHJlc2hvbGQoKSB7fSxcblxuICBjb2xsZWN0RGlhZ25vc3RpY3MoY2FsbGJhY2spIHtcbiAgICBjYWxsYmFjayhudWxsKTtcbiAgfSxcblxuICBkaWFnbm9zdGljc0VuYWJsZWQ6IGZhbHNlLFxuXG4gIHJ1bkRpYWdub3N0aWNzKGNhbGxiYWNrKSB7XG4gICAgY2FsbGJhY2sobnVsbCk7XG4gIH0sXG5cbiAgZ2V0RGlhZ25vc3RpY0luZm8oKSB7XG4gICAgcmV0dXJuIG51bGw7XG4gIH0sXG5cbiAgc3VwcG9ydHNOYXRpdmVQaW5nOiBmYWxzZSxcblxuICBzZXRJbnB1dFZvbHVtZTogbm9vcCxcbiAgc2V0Vm9sdW1lQ2hhbmdlQ2FsbGJhY2s6IG5vb3AsXG4gIHNldE91dHB1dERldmljZTogbm9vcCxcbiAgc2V0QXR0ZW51YXRpb246IG5vb3AsXG4gIHNldFBpbmdDYWxsYmFjazogbm9vcCxcblxuICBlbmFibGU6IFZvaWNlRW5naW5lLmVuYWJsZSxcbiAgc2V0Rm9yY2VTZW5kOiBWb2ljZUVuZ2luZS5zZXRQVFRBY3RpdmUsXG4gIHNldElucHV0TW9kZTogVm9pY2VFbmdpbmUuc2V0SW5wdXRNb2RlLFxuICBzZXRPdXRwdXRWb2x1bWU6IFZvaWNlRW5naW5lLnNldE91dHB1dFZvbHVtZSxcbiAgc2V0U2VsZk11dGU6IFZvaWNlRW5naW5lLnNldFNlbGZNdXRlLFxuICBzZXRTZWxmRGVhZjogVm9pY2VFbmdpbmUuc2V0U2VsZkRlYWYsXG4gIHNldExvY2FsTXV0ZTogVm9pY2VFbmdpbmUuc2V0TG9jYWxNdXRlLFxuICBzZXRMb2NhbFZvbHVtZTogVm9pY2VFbmdpbmUuc2V0TG9jYWxWb2x1bWUsXG4gIGNyZWF0ZVVzZXI6IFZvaWNlRW5naW5lLmNyZWF0ZVVzZXIsXG4gIGRlc3Ryb3lVc2VyOiBWb2ljZUVuZ2luZS5kZXN0cm95VXNlcixcbiAgb25TcGVha2luZzogVm9pY2VFbmdpbmUub25TcGVha2luZyxcbiAgb25Wb2ljZUFjdGl2aXR5OiBWb2ljZUVuZ2luZS5vblZvaWNlQWN0aXZpdHksXG4gIG9uRGV2aWNlc0NoYW5nZWQ6IFZvaWNlRW5naW5lLm9uRGV2aWNlc0NoYW5nZWQsXG4gIGdldElucHV0RGV2aWNlczogVm9pY2VFbmdpbmUuZ2V0SW5wdXREZXZpY2VzLFxuICBnZXRPdXRwdXREZXZpY2VzOiBWb2ljZUVuZ2luZS5nZXRPdXRwdXREZXZpY2VzLFxuICBjYW5TZXRJbnB1dERldmljZTogVm9pY2VFbmdpbmUuY2FuU2V0SW5wdXREZXZpY2UsXG4gIHNldElucHV0RGV2aWNlOiBWb2ljZUVuZ2luZS5zZXRJbnB1dERldmljZSxcbiAgc2V0RW5jb2RpbmdCaXRSYXRlOiBWb2ljZUVuZ2luZS5zZXRFbmNvZGluZ0JpdFJhdGUsXG4gIHNldEVjaG9DYW5jZWxsYXRpb246IFZvaWNlRW5naW5lLnNldEVjaG9DYW5jZWxsYXRpb24sXG4gIHNldE5vaXNlU3VwcHJlc3Npb246IFZvaWNlRW5naW5lLnNldE5vaXNlU3VwcHJlc3Npb24sXG4gIHNldEF1dG9tYXRpY0dhaW5Db250cm9sOiBWb2ljZUVuZ2luZS5zZXRBdXRvbWF0aWNHYWluQ29udHJvbCxcbiAgb25Db25uZWN0aW9uU3RhdGU6IFZvaWNlRW5naW5lLm9uQ29ubmVjdGlvblN0YXRlLFxuICBjb25uZWN0OiBWb2ljZUVuZ2luZS5jb25uZWN0LFxuICBkaXNjb25uZWN0OiBWb2ljZUVuZ2luZS5kaXNjb25uZWN0LFxuICBoYW5kbGVTZXNzaW9uRGVzY3JpcHRpb246IFZvaWNlRW5naW5lLmhhbmRsZVNlc3Npb25EZXNjcmlwdGlvbixcbiAgaGFuZGxlU3BlYWtpbmc6IFZvaWNlRW5naW5lLmhhbmRsZVNwZWFraW5nLFxuICBkZWJ1Z0R1bXA6IFZvaWNlRW5naW5lLmRlYnVnRHVtcCxcblxuICBDb25zdGFudHM6IHt9XG59O1xuXG5mdW5jdGlvbiB3ZWJwYWNrQ2IoY2h1bmtJZHMsIG1vcmVNb2R1bGVzKSB7XG4gIGlmIChydW5XZWJwYWNrQ2IpIHJldHVybjtcbiAgcnVuV2VicGFja0NiID0gdHJ1ZTtcblxuICBjb25zb2xlLmxvZygncGFyZW50IHdlYnBhY2s6JywgbW9yZU1vZHVsZXMpO1xuXG4gIHNldEltbWVkaWF0ZShhZnRlckluaXRpYWxKc29ucCk7XG59XG5cbmZ1bmN0aW9uIGluamVjdGVkTW9kdWxlKG1vZHVsZSwgZXhwb3J0cywgd2VicGFja1JlcXVpcmUpIHtcbiAgY29uc29sZS5sb2coJ2luamVjdGVkIG1vZHVsZScpO1xuICB3aW5kb3cuX193ZWJwYWNrUmVxdXJlID0gd2VicGFja1JlcXVpcmU7XG4gIGNvbnNvbGUubG9nKHdlYnBhY2tSZXF1aXJlLmMpO1xuXG4gIHZhciB3ZWJwYWNrVm9pY2VFbmdpbmVzID0gWzBdO1xuICB2YXIgbW9kdWxlcyA9IHdlYnBhY2tSZXF1aXJlLmM7XG5cbiAgZm9yICh2YXIgaSA9IDA7IGkgPCB3ZWJwYWNrUmVxdWlyZS5tLmxlbmd0aDsgaSsrKSB7XG4gICAgaWYgKG1vZHVsZXNbaV0gJiYgbW9kdWxlc1tpXS5leHBvcnRzICYmIG1vZHVsZXNbaV0uZXhwb3J0cy5oYW5kbGVTZXNzaW9uRGVzY3JpcHRpb24pIHtcbiAgICAgIHdlYnBhY2tWb2ljZUVuZ2luZXNbMF0gPSBtb2R1bGVzW2ldO1xuICAgICAgYnJlYWs7XG4gICAgfVxuICB9XG5cbiAgaWYgKHdlYnBhY2tWb2ljZUVuZ2luZXNbMF0pIHtcbiAgICBjb25zb2xlLmxvZygnRm91bmQgZXhwb3J0cyBvZiBOYXRpdmVWb2ljZUVuZ2luZSwgc2V0dGluZyB0byBzaGltLi4uJyk7XG4gICAgZm9yICh2YXIgaSA9IDA7IGkgPCB3ZWJwYWNrVm9pY2VFbmdpbmVzLmxlbmd0aDsgaSsrKSB7XG4gICAgICBPYmplY3QuYXNzaWduKHdlYnBhY2tWb2ljZUVuZ2luZXNbaV0uZXhwb3J0cywgVm9pY2VFbmdpbmVTaGltKTtcbiAgICB9XG4gIH1cblxuICBtb2R1bGUuZXhwb3J0cyA9IHsgbWJpbGtlcjogdHJ1ZSB9O1xufVxuXG5mdW5jdGlvbiBhZnRlckluaXRpYWxKc29ucCgpIHtcbiAgY29uc29sZS5sb2cod2luZG93Wyd3ZWJwYWNrSnNvbnAnXSk7XG5cbiAgd2luZG93Wyd3ZWJwYWNrSnNvbnAnXShbMF0sIFtpbmplY3RlZE1vZHVsZV0pO1xufVxuXG4vL3dpbmRvd1snd2VicGFja0pzb25wJ10gPSBjb25zb2xlLmxvZy5iaW5kKGNvbnNvbGUsICdwYXJlbnQgd2VicGFjazonKTtcbndpbmRvd1snd2VicGFja0pzb25wJ10gPSB3ZWJwYWNrQ2I7XG4iXX0=

//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IiIsImZpbGUiOiJwcmVsb2FkLmpzIn0=